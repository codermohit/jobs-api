# JOBS API

## USER functionality

#### Setting up routes and controllers

- `routes` : setting up two routes, `auth` and `jobs` , which will handle respective routes. Controllers with same names are setup in the `controllers` folder

#### Setting up UserSchema

- `models/user.js` : User schema is set with fields for name, email and password to contain data for users.
- used regex expression in email , and for password it will be _"hashed"_

#### Hashing password info

- **NEVER EVER SAVE PASSWORDS AS STRINGS**, most users use the same password for most of the sites, if you store their passwords as strings, and your database gets hacked, the hackers will have their passwords.
- **HASHING** : It is combining random generated bytes and combining them with the password. It is one way street, it cannot be reversed.
- `bcryptjs` : the library that can be used for this purpose.
- `.genSalt(), .hash()` : methods used to generate hashed password

```js
const salt = await bcrypt.genSalt(10);
const hashedPassword = await bcrypt.hash(password, salt);
```

#### Mongoose Middleware

- wrote this middleware in the file where _UserSchema_ is defined.
- It is called when the document is saved to the database, before saving , it hashes the password and then saves it.

#### JWT - Generating Token

- used _schema instance methods_ for creating a method on the returned user from the database, `createJWT()`

```js
// in models/user.js
userSchema.methods.createJWT = function () {
  return jwt.sign({ userId: this._id, name: this.name });
};

//in controllers/auth.js
const register = async (req, res) => {
  //other code
  const user = await User.create({
    /*object*/
  });
  const token = user.createJWT();
  res.status(StatusCodes.CREATED).json({ name: user.name, token });
};
```

- Generate a random encrypted key from the net and then set it in the .env file as JWT_SECRET

#### Checking Credentials

> Important

- On the _login_ controller , take email and password from the user and then search for it on the database using `findOne` , and if it returns the user then check for the password

#### Checking Passowrd

- Created another instance method on the schema

```js
//in models/user.js
UserSchema.methods.comparePassword = async function (candidatePassword) {
  const isMatch = bcrypt.compare(candidatePassword, this.password);
  return isMatch;
};
```

- `bcrypt.compare(hashedValue1, value2)` : Check if the passoword matches. `hashedValue1` : received from the database. `value2` : the password sent by the user while logging in

#### Authentication Middleware

- At [authentication.js](./middleware/authentication.js)
- Created the authentication middleware which takes the user's request and searches for the authorization header , extracts token from it.
- `jwt.verify(token, JWT_SECRET)` : token is verified with this method, if it is successful then middleware passes the control to the `next()`
- we can also send the credential of the logged in user using the model and related queries

```js
const user = User.findById(payload.id).select("-password");
req.user = user;
```

### JOBS functionality

#### Jobs model

- created the jobs model which has the general rows , but the _createdBy_ is a special row as it relates to the user who created the document

```js
//inside the jobs schema
createdBy : {
  type : mongoose.Types.ObjectId,
  ref: "User"
}
```

### SECURITY

- will use the npm packages to handle the security of the API
- packages namely : `helmet`, `cors`,`xss` and `rateLimit`
